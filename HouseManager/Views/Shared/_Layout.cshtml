@using System.Security.Claims
@inject SignInManager<IdentityUser> SignInManager
@inject IHouseOrganizationService houseOrg
@inject IHttpContextAccessor HttpContextAccessor

@{
	var houseOrgId = HttpContextAccessor?.HttpContext?.Session.GetInt32(ManagedHouseOrgId) ?? 0;
	var houseOrgName = HttpContextAccessor?.HttpContext?.Session.GetString(ManagedHouseOrgName) ?? "none";
	var userId = User.FindFirstValue(ClaimTypes.NameIdentifier);

	var houseOrgs = houseOrg
							.GetAllByCreatorReadOnly(userId)
							.Select(ho => new SelectListItem
									{
										Value = ho.Id.ToString(),
										Text = ho.Name
									})
									.ToList();
}

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<link href="~/favicon.ico" rel="icon">

	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

	<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600;700&display=swap" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

	<link href="~/css/custom/bootstrap.min.css" rel="stylesheet">
	<link href="~/css/custom/date-picker/bootstrap-datepicker.standalone.min.css" rel="stylesheet">
	<link href="~/css/custom/style.css" rel="stylesheet">
</head>
<body>
	<div class="container-fluid position-relative bg-white d-flex h-100 p-0">
		<div class="content open h-100 d-flex flex-column justify-content-center">
			<nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top px-4">
				<div class="container-fluid">
					<a class="navbar-brand" asp-controller="Home" asp-action="Index">
						<h3 class="text-success mb-0">House Manager</h3>
					</a>
					<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
						<span class="navbar-toggler-icon"></span>
					</button>
					<div class="collapse navbar-collapse" id="navbarSupportedContent">
						<div class="navbar-nav me-auto mb-2 mb-lg-0">
							@if (SignInManager.IsSignedIn(User))
							{
								@if (houseOrgName != "none")
								{
									<div class="nav-item dropdown justify-content-center">
											<a class="nav-link dropdown-toggle fw-bold" style="color: #000000;opacity: 0.7" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
												@houseOrgName
											</a>
										<ul class="dropdown-menu">
											<li>
												<a class="dropdown-item" asp-controller="HouseOrganizations" asp-action="Details" asp-route-id="@houseOrgId"
												   class="nav-item nav-link fw-bold" style="color: #000000;opacity: 0.7">
													<i class="fa fa-info me-2"></i>Details
												</a>
											</li>
											<li><hr class="dropdown-divider"></li>
											<li>
												<a class="dropdown-item" asp-controller="Management" asp-action="All" asp-route-houseOrgId="@houseOrgId"
												   class="nav-item nav-link fw-bold" style="color: #000000;opacity: 0.7">
													<i class="fa fa-user-tie me-2"></i>Management
												</a>
											</li>
											<li><hr class="dropdown-divider"></li>
											<li>
												<a class="dropdown-item" asp-controller="Units" asp-action="All" asp-route-houseOrgId="@houseOrgId"
												   class="nav-item nav-link fw-bold" style="color: #000000;opacity: 0.7">
													<i class="fa fa-key me-2"></i>Units
												</a>
											</li>
											<li><hr class="dropdown-divider"></li>
											<li>
												<a class="dropdown-item" asp-controller="Finances" asp-action="All" asp-route-houseOrgId="@houseOrgId"
												   class="nav-item nav-link fw-bold" style="color: #000000;opacity: 0.7">
													<i class="fa fa-coins me-2"></i>Finances
												</a>
											</li>
										</ul>
									</div>

								}
							}
						</div>
						<partial name="_LoginPartial" />
					</div>
				</div>
			</nav>
			
			<div class="container-fluid d-flex flex-fill pt-4 px-4">
				<div class="row bg-light d-flex flex-fill rounded align-items-top mx-0">
					<main role="main" class="main p-4">
						<div class="bg-light rounded h-100">
							@RenderBody()
						</div>
					</main>
				</div>
			</div>
			
			<div class="container-fluid pt-4 px-4">
				<div class="bg-light rounded-top p-4">
					&copy; House Manager
				</div>
			</div>
		</div>
	</div>
	<script src="~/lib/jquery/dist/jquery.min.js"></script>
	<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
	<script src="~/js/site.js" asp-append-version="true"></script>
	<script src="~/js/custom/main.js"></script>
	<script src="~/js/custom/date-picker/bootstrap-datepicker.min.js"></script>
	@await RenderSectionAsync("Scripts", required: false)
</body>
</html>
